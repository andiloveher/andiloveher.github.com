<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="unclee"><meta name="description" content="来嘛，互相伤害"><link rel="alternative" href="/atom.xml" title="匹夫王T" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>移动端常用处理 - 匹夫王T</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">匹夫王T</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2019-12-04T03:28:08.000Z">December 4, 2019</time><h1 class="post__title"><a href="/2019/12/04/移动端常用/">移动端常用处理</a></h1><div class="post__main echo"><blockquote>
<p>直播协议</p>
<ol>
<li>hls 提供的视频在服务端被切割成ts切片，然后通过m3u8索引文件按序加载</li>
<li>rtmp 只能使用 Flash 实现播放器。它的实时性好，延迟低，但不支持移动端</li>
<li>flv 将流媒体数据封装成flv格式，然后通过http协议传输到客户端,移动端不支持flash，需要使用flv.js进行转码播放</li>
</ol>
</blockquote>
<table>
<thead>
<tr>
<th>协议</th>
<th>传输方式</th>
<th>视频格式</th>
<th>延时</th>
<th>数据分段</th>
</tr>
</thead>
<tbody>
<tr>
<td>flv</td>
<td>http</td>
<td>flv</td>
<td>2s</td>
<td>连续流</td>
</tr>
<tr>
<td>rtmp</td>
<td>tcp</td>
<td>flv tag</td>
<td>2s</td>
<td>连续流</td>
</tr>
<tr>
<td>hls</td>
<td>http</td>
<td>ts</td>
<td>20s</td>
<td>切片</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;video</span><br><span class="line">      webkit-playsinline  <span class="comment">// 针对ios9不全屏播放</span></span><br><span class="line">      playsinline  <span class="comment">// 针对ios10、11不全屏播放</span></span><br><span class="line">      x5-playsinline  <span class="comment">// 阻止x5内核浏览器全屏播放</span></span><br><span class="line">      x-webkit-airplay=<span class="string">"allow"</span>  <span class="comment">// 默认不全屏播放</span></span><br><span class="line">      x5-video-player-type=<span class="string">"h5"</span> <span class="comment">// 限制启用微信默认播放器，改用H5播放</span></span><br><span class="line">      x5-video-player-fullscreen=<span class="string">"true"</span> <span class="comment">// true为支持全屏播放</span></span><br><span class="line">      x5-video-orientation=<span class="string">"portraint"</span> <span class="comment">// 播放器方向，landscape横屏，portraint竖屏</span></span><br><span class="line">      src=<span class="string">"xxxx.m3u8"</span></span><br><span class="line">    /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>单向通信交互</p>
<ol>
<li>url传参</li>
<li>window传参</li>
</ol>
</blockquote>
<blockquote>
<p>双向通信的交互 WebViewJavaScriptBridge</p>
<ol>
<li>WebViewJavaScriptBridge的基本原理简单来说就是，建立一个桥梁，然后注册自己，调用他人。<br>把 OC 的方法注册到桥梁中，让 JS 去调用。<br>把 JS 的方法注册在桥梁中，让 OC 去调用。</li>
</ol>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用 JSFunction ，并向 JS 传递参数，也需要 JSFunction 的返回值。</span></span><br><span class="line">[_jsBridge callHandler:@<span class="string">"a"</span> data:@<span class="string">"传递给 JS 的参数"</span> responseCallback:^(id responseData) &#123;</span><br><span class="line">  NSLog(@<span class="string">"JS 的返回值: %@"</span>,responseData);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// JS 调用 OC 的 block，传递 JS 参数，并接受 OC 的返回值。</span></span><br><span class="line">WebViewJavascriptBridge.callHandler(<span class="string">'b'</span>,&#123;<span class="attr">data</span> : <span class="string">"这是 JS 传递到 OC 的数据"</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">dataFromOC</span>)</span>&#123;</span><br><span class="line">  alert(<span class="string">"JS 调用了 OC 的方法!"</span>);</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"returnValue"</span>).value = dataFromOC;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><p>针对移动端，通常会结合JS依据屏幕宽度与设计图宽度的比例动态声明<html>的font-size，以rem为长度单位声明所有节点的几何属性，这样就能做到大部分移动设备的页面兼容，兼容出入较大的地方再通过媒体查询做特别处理。</html></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 拨打电话 --&gt;</span><br><span class="line">&lt;a href=<span class="string">"tel:10086"</span>&gt;拨打电话给<span class="number">10086</span>小姐姐&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!-- 发送短信 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;a href="sms:10086"&gt;发送短信给10086小姐姐&lt;/</span>a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 发送邮件 --&gt;</span><br><span class="line">&lt;a href=<span class="string">"mailto:young.joway@aliyun.com"</span>&gt;发送邮件给JowayYoung&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!-- 选择照片或拍摄照片 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;input type="file" accept="image/</span>*<span class="string">"&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;!-- 选择视频或拍摄视频 --&gt;</span></span><br><span class="line"><span class="string">&lt;input type="</span>file<span class="string">" accept="</span>video<span class="comment">/*"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 多选文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;input type="file" multiple&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 忽略自动识别电话和邮箱 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="format-detection" content="telephone=no, email=no"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 纯数字带#和* --&gt;</span></span><br><span class="line"><span class="comment">&lt;input type="tel"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 纯数字 --&gt;</span></span><br><span class="line"><span class="comment">&lt;input type="number" pattern="\d*"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 打开微信 --&gt;</span></span><br><span class="line"><span class="comment">&lt;a href="weixin://"&gt;打开微信&lt;/a&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 打开支付宝 --&gt;</span></span><br><span class="line"><span class="comment">&lt;a href="alipays://"&gt;打开支付宝&lt;/a&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 打开支付宝的扫一扫 --&gt;</span></span><br><span class="line"><span class="comment">&lt;a href="alipays://platformapi/startapp?saId=10000007"&gt;打开支付宝的扫一扫&lt;/a&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 打开支付宝的蚂蚁森林 --&gt;</span></span><br><span class="line"><span class="comment">&lt;a href="alipays://platformapi/startapp?appId=60000002"&gt;打开支付宝的蚂蚁森林&lt;/a&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;input autocapitalize="off" autocorrect="off"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Safari</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 设置Safari全屏，在iOS7+无效 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 改变Safari状态栏样式，可选default/black/black-translucent，需在上述全屏模式下才有效 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="apple-mobile-web-app-status-bar-style" content="black"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 添加页面启动占位图 --&gt;</span></span><br><span class="line"><span class="comment">&lt;link rel="apple-touch-startup-image" href="pig.jpg" media="(device-width: 375px)"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 保存网站到桌面时添加图标 --&gt;</span></span><br><span class="line"><span class="comment">&lt;link rel="apple-touch-icon" sizes="76x76" href="pig.jpg"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 保存网站到桌面时添加图标且清除默认光泽 --&gt;</span></span><br><span class="line"><span class="comment">&lt;link rel="apple-touch-icon-precomposed" href="pig.jpg"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 强制QQ浏览器竖屏 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="x5-orientation" content="portrait"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 强制QQ浏览器全屏 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="x5-fullscreen" content="true"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 开启QQ浏览器应用模式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="x5-page-mode" content="app"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 强制UC浏览器竖屏 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="screen-orientation" content="portrait"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 强制UC浏览器全屏 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="full-screen" content="yes"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 开启UC浏览器应用模式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="browsermode" content="application"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;!-- 开启360浏览器极速模式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;meta name="renderer" content="webkit"&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="监听屏幕旋转"><a href="#监听屏幕旋转" class="headerlink" title="监听屏幕旋转"></a>监听屏幕旋转</h4><p>/<em> 横屏 </em>/<br>@media all and (orientation: landscape) {<br>    /<em> 自定义样式 </em>/<br>}<br>/<em> 竖屏 </em>/<br>@media all and (orientation: portrait) {<br>    /<em> 自定义样式 </em>/<br>}</p>
<p>作者：JowayYoung<br>链接：<a href="https://juejin.cn/post/6921886428158754829" target="_blank" rel="noopener">https://juejin.cn/post/6921886428158754829</a></p>
</div></header></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2021 unclee</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>